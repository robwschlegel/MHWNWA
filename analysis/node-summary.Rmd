---
title: "Node summary"
author: "Robert Schlegel"
date: "2019-07-09"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
csl: FMars.csl
bibliography: MHWNWA.bib
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.align = 'center',
                      echo = FALSE, warning = FALSE, message = FALSE, 
                      eval = TRUE, tidy = FALSE)
```


## Introduction

This vignette will show the summary figures for the various SOM experiments. The code used to create these summary figures may be found in `code/functions.R` and a more detailed overview is given in the [Figures vignette](https://robwschlegel.github.io/MHWNWA/node-summary.html). The nodes are listed below by their number. Use the table of contents on the left of the screen to move qucikly between nodes of interest as desired.

## Visualise SOM results

With the following lines of code we create PDFs for each of the variables for each of the nodes for our different conditions. These PDFs may be seen at `output/SOM/*`, where `*` is the code name denoting which SOM experiment was conducted.

```{r som-visualise, eval=FALSE}
# Load all functions etc.
source("code/functions.R")

# All data
  # Note that this will be cropped to the same study area as the no LS run
som_all <- readRDS("data/som_all.Rda")
som_node_visualise(som_all, dir_name = "all")

# No Labrador Shelf
som_nolab <- readRDS("data/som_nolab.Rda")
som_node_visualise(som_nolab, dir_name = "no_ls")

# Na Lab or GSL
som_nolabgsl <- readRDS("data/som_nolabgsl.Rda")
som_node_visualise(som_nolabgsl, dir_name = "no_ls_gsl")

# Na Lab, 9 nodes
som_nolab_9 <- readRDS("data/som_nolab_9.Rda")
som_node_visualise(som_nolab_9, dir_name = "no_ls_3x3", col_num = 3)

# Na Lab, 16 nodes
som_nolab_16 <- readRDS("data/som_nolab_16.Rda")
som_node_visualise(som_nolab_16, dir_name = "no_ls_4x4")

# Na Lab and no moderate events
som_nolabmod <- readRDS("data/som_nolabmod.Rda")
som_node_visualise(som_nolabmod, dir_name = "no_ls_mod", col_num = 2)

# No Lab and no events shorter than 14 days
som_nolab14 <- readRDS("data/som_nolab14.Rda")
som_node_visualise(som_nolab14, dir_name = "no_ls_14", col_num = 3)
```

Juggling back and forth between the SST anomaly photos with and without the Gulf of St Lawrence it first appears that they are very different, but this is mostly due to the top and bottom rows of nodes being flipped. The actual differences are much more muted and the patterns tend to hold. The patterns appear more crisp in the larger of the two study extents. This is likely because the inclusion of the shallow GSL gives more power to the atmospheric variables to compete with the Gulf Stream. For this reason we are going to proceed with the inclusion of the Gulf of St Lawrence.

Looking at different counts of nodes it appears as though 9 is not enough. When 12 nodes are used more detail comes through. Going up to 16 nodes appear to be too much as not much more detail comes through while creating the complexity of more node results to sift through. When the moderate events are removed we are left with only 37 events (synoptic states) to feed the SOM. This means we shouldn't use more than 4 nodes so as not to (be just shy of) at least 10 potential values binned into each node. The four nodes that are output do show the most clear difference in patterns and actually do a surprising job of ecapsulating the different potential drivers of MHWs. An ANOSIM test on the nodes show that they are different with a _p_ = 0.046. All of the other results have a ANOSIM of _p_ = 0.001. One issue with screening the events by category is that this part of the ocean experiences many long category I Moderate events that may still be relevant.

So rather than screen by category, I also made a run on the SOM with MHW data with events shorter than 14 days removed. This left us with 103 events to work with, whcih is a good number to use with a 3x3 grid. The results tell perhaps a clearer story than with the 12 nodes and all MHWs. 

Just from looking at the node summaries created in this vignette it is too difficult to say conclusively which conditional produces the clearest results. We will need to proceed with the creation of the more in depth node summary figures in order to get a better idea of how well this is working out. Also unresolved in this vignette is the criticism that the methodology used for the creation of the mean synoptic states fed to the SOM is weak to long events coming through as "grey", meaning they average out to a rather unremarkable state, even though they are likely the most important of all. One proposed fix for this is to create synoptic states using only the peak date of the event, rather than a mean over the range of the event. This should be looked into...

A last point here is also that this methodology should also be useful for looking backwards and forwards through time to see what the synoptic states looked like leading up to and just after the event. This information could be more useful than the first wave of results. Before doing this however a singular methodology needs to be pinned down (i.e. which events to screen and how many nodes to use).

See the files in the `/output/SOM_nodes/` folder in the GitHub repo for this project. They aren't all shown here because they take a bit too long to render. 
<!-- But the following shows what the SST anomaly nodes look like. -->

## Node summary table

The table below contains a concise summary of the nodes from the more promising SOM experiments.

|Node|Region    |Season    |MHW Properties    |Conditions       |
|----|----------|----------|------------------|-----------------|
|1   |LS        |Australia |Spicey            |All of the things|

## Figure caption key

The captions for the figures below have a lot of acronyms in them but they are consistently used and I will provide a list of what they are here. Whenever one sees an acronym in lower case letters it is refering to one of the regions of the study area as seen in the following figure.

```{r study-regions, out.width='100%', fig.align='center', fig.cap='The regions of the coast were devided up by their temperature and salinity regimes based on work by @Richaud2016. The regions were furthered divided into sub-regions based on their depth.'}
# knitr::include_graphics("assets/study_regions.png")
```

The region abbreviations are:  

- gm = Gulf of Maine
- gls = Gulf of St. Lawrence  
- ls = Labrador Shelf  
- mab = Mid-Atlantic Bight
- nfs = Newfoundland Shelf  
- ss = Scotian Shelf  

The upper case acronyms used in the following figure captions are as follows:  

- SST = Sea surface temperature
- SOM = Self-organising map(s)
- GS = Gulf Stream
- AO = Atlantic Ocean
- LS = Labrador Sea
- LC = Labrador Current
- NS = Nova Scotia

If I have missed any please don't hesitate to send me a message.

## SST overview

The figure below shows the SST anomaly per node as a means of providing a very general overview of what each node looks like so as to make navigating between them more convenient.

```{r sst-summary, out.width='100%', fig.align='center', fig.cap='The SST anomaly per node of the SOM. Note that the SST patterns are calculated in conjunction with the several other variables and are not the only variable taken into account. They are shown here by themselves as I think they provide the most convenient single snap shot of the results.'}
knitr::include_graphics("assets/som_plot_sst_anom.png")
```

## Node 1

```{r node-1, out.width='100%', fig.align='center', fig.cap='Warm pulse of GS near the NS coast. Shallowing mixed layer, low wind stress, and strong negative heat flux. Mostly gm and ss, almost no nfs. Almost entirely summer and autumn from 2013 - 2016. Mostly smaller evets but a few are massive.'}
knitr::include_graphics("assets/node_1_panels.png")
```

## Node 2

```{r node-2, out.width='100%', fig.align='center', fig.cap='Cold GS with warm LC caused by positive heat flux, low wind stress, and shallow mixed layer. Mostly cbs with some gsl and no mab. Occurred in only one year in two pulses in spring and summer. Normal intensity but short duration.'}
knitr::include_graphics("assets/node_2_panels.png")
```

## Node 3

```{r node-3, out.width='100%', fig.align='center', fig.cap='Calm sea state with some positive heatflux into the LC causing events. Shallower mixed layer everywhere. Mostly nfs with progressively fewer events in regions down the coast. Almost none in ls. Smaller events with a couple of large ones. All seasons from 1999 - 2014.'}
knitr::include_graphics("assets/node_3_panels.png")
```

## Node 4

```{r node-4, out.width='100%', fig.align='center', fig.cap='Extremely shallow mixed layer with a strong positive heatflux and low wind stress. Mostly nfs with progressively fewer events further away. Smaller events. Autumn, Winter, and Spring from 1999 - 2014.'}
knitr::include_graphics("assets/node_4_panels.png")
```

## Node 5

```{r node-5, out.width='100%', fig.align='center', fig.cap='Slightly shallow slightly fast push of the GS into the coast becoming slightly deeper near WHOI before coming back away from the coast and chilling out. The core of the pulse has negative heatflux but the surrounding GS has a strong positive heatflux and snall wind stress. Almost exclusively occurs in mab with only a bit everywhere else. Smallish events with a few massive ones. All seasons from 2003 - 2015.'}
knitr::include_graphics("assets/node_5_panels.png")
```

## Node 6

```{r node-6, out.width='100%', fig.align='center', fig.cap='Slightly warmer LS and LC with cooler GS. Minor poitive heat flux into LS and large positive heat flux into GS. Normal mixed layer with low wind stress over the LS and high over the GS. Mostly in the ls with a bit in the mab with almost none elsewhere. Occurred over 1999 - 2010 in spring and summer. Smaller events that have not been increasing over time.'}
knitr::include_graphics("assets/node_6_panels.png")
```

## Node 7

```{r node-7, out.width='100%', fig.align='center', fig.cap='Warm waters from LS to LC to GSL and a cold GS. Strong downward heat flux over northern waters and negative flux over GS. Shallow northern waters with low wind stress while high stress over GS. Equally high in ls and nfs. A bit in cbs but almost none elsewhere. Spring - Autumn from 2000 - 2014. 2006 was a particularly strong year. Events are overall not particularly large.'}
knitr::include_graphics("assets/node_7_panels.png")
```

## Node 8

```{r node-8, out.width='100%', fig.align='center', fig.cap='Warm northern waters with a cold GS. Strong positive flux over LS with weaker positive flux over GSL and negative over GS. Very shallow LS and very deep GS. Affects all northern waters but highest in gsl and ls. No events in mab and almost none in gm. Almost always Autumn and Winter from 2006 - 2013. Some more intense events later on with 2010/11 being a larger year.'}
knitr::include_graphics("assets/node_8_panels.png")
```

## Node 9

```{r node-9, out.width='100%', fig.align='center', fig.cap='Similar to node 5. Strong nearshore GS pulse. Strong negative flux over LS and GS but positive over the rest of the Atlantic. Very strong wind stress over LS and eastern part of Atlantic, weak over the warm heat flux area of the Atlantic. Extremely deep LS and shallow GS. Occurred over 2002 - 2016 for winter and spring, events began occurring in Autumn from 2013. Evens becoming rather intense as time progresses with some massive ones. Increasing in intensity in most regions.'}
knitr::include_graphics("assets/node_9_panels.png")
```

## Node 10

```{r node-10, out.width='100%', fig.align='center', fig.cap='Very unstable mostly cold GS with warm GM and SS waters. Negative heat flux into shelf waters and positive into GS. High wind stress over LS and low over shelf waters. Deep GS and GM waters but shallow over SS. Spread out over most regions with fewest events in mab and nfs. A few tiny events from 2009 - 2011 but really got going from 2012 - 2013. Spring of 2013 was small while Autumn/WInter of 2012/13 was noteworthy.'}
knitr::include_graphics("assets/node_10_panels.png")
```

## Node 11

```{r node-11, out.width='100%', fig.align='center', fig.cap='Energetic but normal temperature GS with warm inshore waters and slightly warm LS. Positive heat flux into GS and LS but negative into inshore waters. High wind stress above LS and a bit over central AO, but negative everywhere else. Very deep mixed layer next to coast in MAB but relatively normal everywhere else. Relatively equivalent occurrence in all regions. Occurred only from July - October, 2012. A few decent sized events. Mean max intensity is decent.'}
knitr::include_graphics("assets/node_11_panels.png")
```

## Node 12

```{r node-12, out.width='100%', fig.align='center', fig.cap='Warm inshore and LS waters with cold GS and AO. GS is moving fast and consistent. Negative heatflux into GS and inshore waters, slightly positive into LS and AO. High wind stress over GS and AO, negative over inshore waters and LS. Very deep mixed layer along coast in mab and very shallow along coast in ls. Mostly events occurring in gsl, but also in other northern areas. Occurred every even year from 2008 to 2014 from ~June - September. Relatively small (short) events but with decent max intensities.'}
knitr::include_graphics("assets/node_12_panels.png")
```

## References
