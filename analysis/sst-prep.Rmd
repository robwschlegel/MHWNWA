---
title: "SST preparation"
author: "Robert Schlegel"
date: "2019-05-23"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.align = 'center',
                      echo = TRUE, warning = FALSE, message = FALSE, 
                      eval = TRUE, tidy = FALSE)
```

## Introduction

Building on the work performed in the [Polygon preparation](https://robwschlegel.github.io/MHWNWA/polygon-prep.html) vignette, we will now create grouped SST time series for the regions in our study area based on the 50 and 200 m isobaths within each. This will not be done by using shape files to define the area, as previously planned. Rather we will find the mean depth for each SST pixel and assign it to one of the three depth classes within each region. How this looks is shown below.

```{r libraries}
# Packages used in this vignette
library(tidyverse) # Base suite of functions
library(heatwaveR, lib.loc = "../R-packages/") # For detecting MHWs
cat(paste0("heatwaveR version = ",packageDescription("heatwaveR")$Version))
library(FNN) # For fastest nearest neighbour searches
```


## Loading data

Before we access the SST data from the 3-Oceans model, let's load all of the polygons and bathymetry data we will need to create our grouped time series.

```{r load-poly-bathy}
# Corners of the study area
NWA_corners <- readRDS("data/NWA_corners.Rda")

# Individual regions
NWA_coords <- readRDS("data/NWA_coords_cabot.Rda")

# Lowres bathymetry
NWA_bathy <- readRDS("data/NWA_bathy_lowres.Rda")

# The 3-Oceans (NAPA) model lon/lat values
model_coords <- readRDS("data/model_coords.Rda")
```


## Assign depths to pixels

Now that we have our data loaded we can assign depth values to each of the model pixels.

I need to look into the model structure to see if it doesn't already have its own bathymetry layer. It would make more sense to use that.

```{r model-pixel-depth}
# Fastest nearest neighbour search for model pixels against bathymetry data

```


## Assign pixels to regions

With the depths for the model pixels worked out we may now assign them within one of the seven regions.
